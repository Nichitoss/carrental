<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ - Car Rental</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<header>
    <div class="header-content">
        <h1>üöó Car Rental</h1>
        <nav>
            <a href="/index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/register.html">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            <a href="/author.html">–û–± –∞–≤—Ç–æ—Ä–µ</a>
        </nav>
    </div>
</header>
<main class="card">
    <h2>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
    <form id="loginForm">
        <label>
            –õ–æ–≥–∏–Ω
            <input name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required autofocus>
        </label>
        <label>
            –ü–∞—Ä–æ–ª—å
            <div class="password-input-wrapper">
                <input name="password" type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                <button type="button" class="toggle-password" onclick="togglePassword('passwordInput', this)" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
                    üëÅÔ∏è
                </button>
            </div>
        </label>
        <button type="submit">–í–æ–π—Ç–∏</button>
    </form>
    <div id="loginMsg" class="msg"></div>
    <p style="text-align: center; margin-top: 1.5rem;">
        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="/register.html">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
    </p>
</main>
<script>
    const form = document.getElementById('loginForm');
    const msg = document.getElementById('loginMsg');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        msg.className = 'msg';
        
        const payload = {
            username: form.username.value.trim(),
            password: form.password.value
        };
        
        try {
            const res = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload),
                credentials: 'include'
            });
            
            const data = await res.json();
            
            if (res.ok) {
                msg.textContent = '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...';
                msg.className = 'msg success';
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 500);
            } else {
                msg.textContent = '‚ùå ' + (data.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.');
                msg.className = 'msg error';
            }
        } catch (error) {
            msg.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
            msg.className = 'msg error';
        }
    });
    
    function togglePassword(inputId, button) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            button.textContent = 'üôà';
        } else {
            input.type = 'password';
            button.textContent = 'üëÅÔ∏è';
        }
    }
</script>
</body>
</html>

