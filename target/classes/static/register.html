<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - Car Rental</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<header>
    <div class="header-content">
        <h1>üöó Car Rental</h1>
        <nav>
            <a href="/index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/login.html">–í–æ–π—Ç–∏</a>
            <a href="/author.html">–û–± –∞–≤—Ç–æ—Ä–µ</a>
        </nav>
    </div>
</header>
<main class="card">
    <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <form id="regForm">
        <label>
            –õ–æ–≥–∏–Ω
            <input name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required autofocus>
        </label>
        <label>
            Email
            <input name="email" type="email" placeholder="example@mail.com" required>
        </label>
        <label>
            –ü–∞—Ä–æ–ª—å
            <div class="password-input-wrapper">
                <input name="password" type="password" id="passwordInput" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required minlength="6">
                <button type="button" class="toggle-password" onclick="togglePassword('passwordInput', this)" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
                    üëÅÔ∏è
                </button>
            </div>
        </label>
        <label>
            –ò–º—è
            <input name="firstName" placeholder="–í–∞—à–µ –∏–º—è" required>
        </label>
        <label>
            –§–∞–º–∏–ª–∏—è
            <input name="lastName" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è" required>
        </label>
        <button type="submit">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </form>
    <div id="regMsg" class="msg"></div>
    <p style="text-align: center; margin-top: 1.5rem;">
        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="/login.html">–í–æ–π—Ç–∏</a>
    </p>
</main>
<script>
    const form = document.getElementById('regForm');
    const msg = document.getElementById('regMsg');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        msg.className = 'msg';
        
        const payload = {
            username: form.username.value.trim(),
            email: form.email.value.trim(),
            password: form.password.value,
            firstName: form.firstName.value.trim(),
            lastName: form.lastName.value.trim()
        };
        
        try {
            const res = await fetch('/api/auth/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload),
                credentials: 'include'
            });
            
            const data = await res.json();
            
            if (res.ok) {
                msg.textContent = '‚úÖ –ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...';
                msg.className = 'msg success';
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 1000);
            } else {
                msg.textContent = '‚ùå ' + (data.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.');
                msg.className = 'msg error';
            }
        } catch (error) {
            msg.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
            msg.className = 'msg error';
        }
    });
    
    function togglePassword(inputId, button) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            button.textContent = 'üôà';
        } else {
            input.type = 'password';
            button.textContent = 'üëÅÔ∏è';
        }
    }
</script>
</body>
</html>

